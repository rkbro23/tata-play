<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tata Play IPTV</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Tata Play Logo -->
  <img src="tp.png" alt="Tata Play Logo" class="tata-logo" />

  <!-- Header -->
  <div class="header">
    <h1>Tata Play IPTV</h1>
  </div>

  <!-- Search & Filter Controls -->
  <div class="filters">
    <input type="text" id="searchInput" class="filter-input" placeholder="Search by channel name..." />
    <select id="categoryFilter" class="filter-select">
      <option value="">All Categories</option>
    </select>
    <select id="qualityFilter" class="filter-select">
      <option value="">All Qualities</option>
    </select>
    <select id="audioFilter" class="filter-select">
      <option value="">All Audio</option>
    </select>
    <button class="refresh-btn" onclick="loadChannels()">Refresh</button>
  </div>

  <!-- Channel Grid -->
  <div id="channelGrid" class="channel-grid"></div>

  <!-- Player Modal -->
  <div id="playerWrapper" class="player-wrapper">
    <video id="videoPlayer" controls autoplay></video>
    <button class="close-player-btn" onclick="closePlayer()">X</button>
  </div>

  <!-- Script -->
  <script>
    const channelGrid = document.getElementById("channelGrid");
    const videoPlayer = document.getElementById("videoPlayer");
    const playerWrapper = document.getElementById("playerWrapper");

    let channels = [];

    async function loadChannels() {
      const res = await fetch("channels.json");
      channels = await res.json();
      renderChannels();
      populateFilters();
    }

    function renderChannels() {
      const search = document.getElementById("searchInput").value.toLowerCase();
      const category = document.getElementById("categoryFilter").value;
      const quality = document.getElementById("qualityFilter").value;
      const audio = document.getElementById("audioFilter").value;

      channelGrid.innerHTML = "";

      const filtered = channels.filter(channel => {
        return (
          (!search || channel.name.toLowerCase().includes(search)) &&
          (!category || channel.name.toLowerCase().includes(category.toLowerCase())) &&
          (!quality || channel.quality === quality) &&
          (!audio || channel.audio === audio)
        );
      });

      filtered.forEach(channel => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${channel.logo || 'tp.png'}" alt="${channel.name}">
          <h3>${channel.name}</h3>
          <p class="category">${channel.quality || ""} ${channel.audio || ""}</p>
        `;
        card.onclick = () => playChannel(channel.url || channel.m3u8);
        channelGrid.appendChild(card);
      });
    }

    function playChannel(url) {
      videoPlayer.src = url;
      playerWrapper.classList.add("show");
    }

    function closePlayer() {
      playerWrapper.classList.remove("show");
      videoPlayer.pause();
      videoPlayer.src = "";
    }

    function populateFilters() {
      const categories = new Set();
      const qualities = new Set();
      const audios = new Set();

      channels.forEach(channel => {
        const name = channel.name.toLowerCase();
        const words = name.split(" ");
        words.forEach(word => categories.add(word));
        if (channel.quality) qualities.add(channel.quality);
        if (channel.audio) audios.add(channel.audio);
      });

      populateSelect("categoryFilter", categories);
      populateSelect("qualityFilter", qualities);
      populateSelect("audioFilter", audios);
    }

    function populateSelect(id, items) {
      const select = document.getElementById(id);
      select.innerHTML = `<option value="">All ${id.replace("Filter", "")}</option>`;
      Array.from(items).sort().forEach(item => {
        select.innerHTML += `<option value="${item}">${item}</option>`;
      });
    }

    document.getElementById("searchInput").addEventListener("input", renderChannels);
    document.getElementById("categoryFilter").addEventListener("change", renderChannels);
    document.getElementById("qualityFilter").addEventListener("change", renderChannels);
    document.getElementById("audioFilter").addEventListener("change", renderChannels);

    loadChannels();
  </script>
</body>
</html>
